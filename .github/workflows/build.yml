name: Build
on:
  #push:
  #  paths-ignore:
  #    - '.gitignore'
  #    - '*.md'
  
  #schedule:
  #  - cron: '0 8 * * *' # run at 8 AM UTC/ 12 AM AKDT

  workflow_dispatch:

jobs:
  build:
    strategy:
      fail-fast: false
      matrix:
        build_type: ['Debug', 'Release']
        config:
          - { name: 'üçè macOS Clang', os: macos-latest }
          - { name: 'üêß Linux GCC', os: ubuntu-latest }
          - { name: 'ü™ü Windows MSVC', os: windows-latest }

    name: üõ† Build / ${{ matrix.config.name }} (${{ matrix.build_type }})
    runs-on: ${{ matrix.config.os }}

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: recursive
          lfs: true
      - name: Setup Node.js environment
        uses: actions/setup-node@v3.9.1
        
      - name: Setup Godot
        if: matrix.config.os != 'windows-latest'
        # You may pin to the exact commit or the version.
        # uses: lihop/godot-setup@f62f7730e1811dc58bb7edc426c1bdbd80bb0c08
        uses: lihop/godot-setup@v2.1.3
        with:
          # Godot version to use
          version: 4.4.1-stable

      - name: Install Dependencies (macOS)
        if: matrix.config.os == 'macos-latest'
        run: brew install haxe

      - name: Install Dependencies (Linux)
        if: matrix.config.os == 'ubuntu-latest'
        run: |
          sudo apt-get update
          sudo apt-get install -y haxe

      - name: Install Dependencies (Windows)
        if: matrix.config.os == 'windows-latest'
        run: |
          choco upgrade haxe godot

      - name: Test Godot
        run: |
          godot --version
